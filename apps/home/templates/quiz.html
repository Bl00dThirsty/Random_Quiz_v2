{% extends "layouts/base.html" %}

{% block title %}  Quiz{% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}


{% block content %}

<div id="app">
    <div class="container mt-5 pt-5">
      <div class="col-md-6 mx-auto">
        <hr>
        <p>[[currentQuestion.question]]</p>
        <div class="form-check" v-for="answer in currentQuestion.answers">
          <input @change="checkAnswer($event, currentQuestion.uid)" :value="answer.answer" class="form-check-input" type="radio" name="flexRadioDefault" :id="answer.id">
          <label class="form-check-label" :for="answer.id">
            [[answer.answer]]
          </label>
        </div>
        <hr>
      </div>
    </div>
    <button @click="nextQuestion">Suivant</button>
  </div>



    {% endblock content %}
    
    
    
   


    {% block javascripts %}
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    
    <script>
    var app = new Vue({
      el: '#app',
      delimiters: ['[[', ']]'],
      data() {
        return {
          category: '{{category}}',
          questions: [],
          currentQuestion: null,
        };
      },
      methods: {
        getQuestions() {
            var _this = this;
            return fetch(`/api/get-quiz/?category=${this.category}`)
                .then(response => response.json())
                .then(result => {
                console.log(result);
                _this.questions = result.data;
                if (_this.questions.length > 0) {
                    _this.currentQuestion = _this.questions[0];
                }
                });
            },
        checkAnswer(event, uid) {
          this.questions.map(question => {
            answers = question.answers;
            for (var i = 0; i < answers.length; i++) {
              if (answers[i].answer == event.target.value) {
                if (answers[i].is_correct) {
                  console.log('reponse juste');
                  alert('hurrrr correcte');
                } else {
                  console.log('reponse fausse');
                }
              }
            }
          });
    
          console.log(event.target.value, uid);
        },
        nextQuestion() {
            const currentIndex = this.questions.indexOf(this.currentQuestion);
            const nextIndex = currentIndex + 1;
            if (nextIndex < this.questions.length) {
            this.currentQuestion = this.questions[nextIndex];
            }
        },
      },
      created() {
        this.getQuestions();
      }
    });
    </script>
    {% endblock javascripts %}